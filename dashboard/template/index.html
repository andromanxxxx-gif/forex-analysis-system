<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Forex Trading System</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        .container { 
            max-width: 1400px; 
            margin: 0 auto; 
            background: rgba(255,255,255,0.98); 
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header { 
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white; 
            padding: 25px; 
            text-align: center;
        }
        .header h1 { 
            font-size: 2.2em; 
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }
        .controls { 
            background: white; 
            padding: 18px; 
            border-bottom: 1px solid #eee;
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center;
        }
        .control-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        select, button {
            padding: 9px 14px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 13px;
            transition: all 0.3s;
        }
        select:focus, button:hover {
            border-color: #3498db;
            outline: none;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
        }
        button:hover {
            background: #2980b9;
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }
        .analysis-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(340px, 1fr)); 
            gap: 18px; 
            padding: 18px;
        }
        .card { 
            background: white; 
            padding: 22px; 
            border-radius: 10px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            transition: transform 0.3s, box-shadow 0.3s;
            border-left: 4px solid #3498db;
        }
        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 18px rgba(0,0,0,0.12);
        }
        .signal-buy { border-left-color: #27ae60; }
        .signal-sell { border-left-color: #e74c3c; }
        .signal-hold { border-left-color: #f39c12; }
        .card h2, .card h3 { 
            color: #2c3e50; 
            margin-bottom: 12px;
            border-bottom: 1px solid #ecf0f1;
            padding-bottom: 8px;
        }
        .price-display {
            font-size: 1.6em;
            font-weight: bold;
            color: #2c3e50;
            margin: 8px 0;
        }
        .price-change {
            font-size: 1.1em;
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 4px;
            display: inline-block;
        }
        .positive { background: #d4edda; color: #155724; }
        .negative { background: #f8d7da; color: #721c24; }
        .confidence-bar { 
            background: #ecf0f1; 
            height: 22px; 
            border-radius: 10px; 
            margin: 12px 0; 
            overflow: hidden;
        }
        .confidence-fill { 
            height: 100%; 
            border-radius: 10px; 
            transition: width 0.5s ease-in-out;
            background: linear-gradient(90deg, #e74c3c, #f39c12, #27ae60);
        }
        .news-item { 
            border-bottom: 1px solid #ecf0f1; 
            padding: 10px 0; 
            transition: background 0.3s;
        }
        .news-item:hover {
            background: #f8f9fa;
            border-radius: 4px;
            padding-left: 8px;
        }
        .signal-display {
            font-size: 1.3em;
            font-weight: bold;
            text-align: center;
            padding: 12px;
            border-radius: 6px;
            margin: 12px 0;
        }
        .signal-buy-display { background: #d4edda; color: #155724; }
        .signal-sell-display { background: #f8d7da; color: #721c24; }
        .signal-hold-display { background: #fff3cd; color: #856404; }
        .loading { 
            text-align: center; 
            padding: 35px; 
            font-size: 1.1em;
            color: #7f8c8d;
        }
        .error { 
            background: #f8d7da; 
            color: #721c24; 
            padding: 12px; 
            margin: 15px;
            border-radius: 6px;
            border-left: 4px solid #e74c3c;
        }
        .technical-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 8px;
        }
        .tech-item {
            background: #f8f9fa;
            padding: 6px;
            border-radius: 4px;
            font-size: 0.85em;
        }
        .chart-container {
            grid-column: 1 / -1;
            height: 450px;
            margin: 15px 0;
            position: relative;
        }
        .chart-controls {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }
        .chart-btn {
            padding: 6px 12px;
            border: 1px solid #ddd;
            background: #f8f9fa;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
        }
        .chart-btn.active {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }
        .trading-levels {
            display: flex;
            justify-content: space-between;
            margin-top: 12px;
            flex-wrap: wrap;
            gap: 8px;
        }
        .level-item {
            text-align: center;
            padding: 6px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
        }
        .level-buy { background: #d4edda; color: #155724; }
        .level-sell { background: #f8d7da; color: #721c24; }
        .level-neutral { background: #fff3cd; color: #856404; }
        .historical-stats {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 6px;
            margin-top: 12px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 8px;
            margin-top: 8px;
        }
        .stat-item {
            text-align: center;
            padding: 6px;
            background: white;
            border-radius: 4px;
            border-left: 2px solid #3498db;
            font-size: 0.8em;
        }
        .data-info {
            background: #e8f4fd;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 0.85em;
            text-align: center;
            color: #2c3e50;
        }
        .system-status {
            background: #d4edda;
            padding: 8px 12px;
            border-radius: 4px;
            margin: 5px 0;
            font-size: 0.8em;
        }
        @media (max-width: 768px) {
            .analysis-grid { grid-template-columns: 1fr; }
            .controls { flex-direction: column; align-items: stretch; }
            .control-group { justify-content: space-between; }
            .chart-container { height: 320px; }
            .trading-levels { flex-direction: column; }
            .stats-grid { grid-template-columns: 1fr 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ AI Forex Trading System</h1>
            <p>Real-time Analysis for JPY Pairs - Powered by DeepSeek AI</p>
        </div>

        <div class="controls">
            <div class="control-group">
                <label><strong>Currency Pair:</strong></label>
                <select id="pairSelect">
                    <option value="GBPJPY">GBP/JPY</option>
                    <option value="USDJPY">USD/JPY</option>
                    <option value="EURJPY">EUR/JPY</option>
                    <option value="CHFJPY">CHF/JPY</option>
                </select>
            </div>
            
            <div class="control-group">
                <label><strong>Timeframe:</strong></label>
                <select id="timeframeSelect">
                    <option value="1H">1 Hour</option>
                    <option value="2H">2 Hours</option>
                    <option value="4H" selected>4 Hours</option>
                    <option value="1D">1 Day</option>
                </select>
            </div>

            <button onclick="loadAnalysis()">üîÑ Refresh Analysis</button>
            <button onclick="loadAllAnalysis()">üìä Analyze All Pairs</button>
            <button onclick="autoRefreshToggle()">‚è∞ Auto Refresh: <span id="autoRefreshStatus">OFF</span></button>
            <button onclick="checkSystemStatus()">üìà System Status</button>
        </div>

        <div id="loading" class="loading" style="display: none;">
            <div>üîÑ Loading AI Analysis...</div>
            <div style="font-size: 0.9em; margin-top: 8px; color: #95a5a6;">
                Analyzing technical indicators and market news...
            </div>
        </div>
        
        <div id="error" class="error" style="display: none;"></div>
        <div id="systemStatus" style="display: none;"></div>
        <div id="results"></div>
    </div>

    <script>
        let autoRefreshInterval = null;
        let currentChart = null;
        let currentChartType = 'line';
        let currentAnalysis = null;
        
        function loadAnalysis() {
            const pair = document.getElementById('pairSelect').value;
            const timeframe = document.getElementById('timeframeSelect').value;
            
            showLoading();
            hideError();
            hideSystemStatus();
            
            console.log(`Loading analysis for ${pair} ${timeframe}`);
            
            fetch(`/get_analysis?pair=${pair}&timeframe=${timeframe}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    hideLoading();
                    if (data.error) {
                        showError('Analysis Error: ' + data.error);
                    } else {
                        console.log('Analysis data received:', data);
                        currentAnalysis = data;
                        displayAnalysis(data);
                    }
                })
                .catch(error => {
                    hideLoading();
                    console.error('Fetch error:', error);
                    showError('Network Error: ' + error.message);
                });
        }

        function loadAllAnalysis() {
            const timeframe = document.getElementById('timeframeSelect').value;
            showLoading();
            hideError();
            hideSystemStatus();
            
            fetch(`/get_multiple_analysis?timeframe=${timeframe}`)
                .then(response => response.json())
                .then(data => {
                    hideLoading();
                    displayAllAnalysis(data);
                })
                .catch(error => {
                    hideLoading();
                    showError('Error loading all analysis: ' + error.message);
                });
        }

        function checkSystemStatus() {
            fetch('/system_status')
                .then(response => response.json())
                .then(data => {
                    displaySystemStatus(data);
                })
                .catch(error => {
                    showError('Error checking system status: ' + error.message);
                });
        }

        function displaySystemStatus(status) {
            const statusDiv = document.getElementById('systemStatus');
            if (status.status === 'operational') {
                statusDiv.innerHTML = `
                    <div class="system-status">
                        <strong>‚úÖ System Status: Operational</strong><br>
                        Analysis Records: ${status.database.analysis_records} | 
                        News Records: ${status.database.news_records} | 
                        Price Records: ${status.database.price_records}
                    </div>
                `;
            } else {
                statusDiv.innerHTML = `
                    <div class="error">
                        <strong>‚ùå System Status: Error</strong><br>
                        ${status.message}
                    </div>
                `;
            }
            statusDiv.style.display = 'block';
        }

        function hideSystemStatus() {
            document.getElementById('systemStatus').style.display = 'none';
        }

        function autoRefreshToggle() {
            const statusElement = document.getElementById('autoRefreshStatus');
            
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
                autoRefreshInterval = null;
                statusElement.textContent = 'OFF';
                statusElement.style.color = '#e74c3c';
            } else {
                autoRefreshInterval = setInterval(loadAnalysis, 300000);
                statusElement.textContent = 'ON (5min)';
                statusElement.style.color = '#27ae60';
                loadAnalysis();
            }
        }

        function switchChartType(type) {
            currentChartType = type;
            if (currentAnalysis && currentAnalysis.chart_data) {
                createChart(currentAnalysis.chart_data, currentAnalysis.ai_analysis);
            }
        }

        function createChart(chartData, analysis) {
            if (currentChart) {
                currentChart.destroy();
            }
            
            const ctx = document.getElementById('priceChart');
            if (!ctx) {
                console.error('Chart canvas not found!');
                return;
            }
            
            const chartContext = ctx.getContext('2d');
            if (!chartContext) {
                console.error('Could not get chart context!');
                return;
            }
            
            console.log('Creating chart with data points:', chartData.dates.length);
            
            try {
                currentChart = new Chart(chartContext, {
                    type: 'line',
                    data: {
                        labels: chartData.dates || [],
                        datasets: [
                            {
                                label: 'Close Price',
                                data: chartData.close || [],
                                borderColor: '#3498db',
                                backgroundColor: 'rgba(52, 152, 219, 0.1)',
                                borderWidth: 2,
                                fill: true,
                                tension: 0.1
                            },
                            {
                                label: 'EMA 20',
                                data: chartData.ema_20 || [],
                                borderColor: '#e74c3c',
                                borderWidth: 1,
                                borderDash: [5, 5],
                                fill: false,
                                tension: 0.1
                            },
                            {
                                label: 'EMA 50',
                                data: chartData.ema_50 || [],
                                borderColor: '#f39c12',
                                borderWidth: 1,
                                borderDash: [5, 5],
                                fill: false,
                                tension: 0.1
                            },
                            {
                                label: 'EMA 200',
                                data: chartData.ema_200 || [],
                                borderColor: '#27ae60',
                                borderWidth: 2,
                                fill: false,
                                tension: 0.1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Price Chart with Moving Averages',
                                font: { size: 16 }
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed.y !== null) {
                                            label += context.parsed.y.toFixed(4);
                                        }
                                        return label;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                title: { display: true, text: 'Time' },
                                ticks: { maxTicksLimit: 8 }
                            },
                            y: {
                                title: { display: true, text: 'Price' },
                                ticks: { 
                                    callback: function(value) {
                                        return value.toFixed(3);
                                    }
                                }
                            }
                        },
                        interaction: {
                            mode: 'nearest',
                            axis: 'x',
                            intersect: false
                        }
                    }
                });
                
                console.log('Chart created successfully');
                
                // Add trading levels
                if (chartData.close && chartData.close.length > 0) {
                    addTradingLevels(analysis, chartData.close[chartData.close.length - 1]);
                }
            } catch (error) {
                console.error('Error creating chart:', error);
                showError('Chart Error: ' + error.message);
            }
        }

        function addTradingLevels(analysis, currentPrice) {
            const levelsHtml = `
                <div class="trading-levels">
                    <div class="level-item ${analysis.SIGNAL.includes('BUY') ? 'level-buy' : analysis.SIGNAL.includes('SELL') ? 'level-sell' : 'level-neutral'}">
                        <div>Entry: ${analysis.ENTRY_PRICE}</div>
                        <div>${analysis.SIGNAL}</div>
                    </div>
                    <div class="level-item level-buy">
                        <div>Take Profit 1</div>
                        <div>${analysis.TAKE_PROFIT_1}</div>
                    </div>
                    <div class="level-item level-buy">
                        <div>Take Profit 2</div>
                        <div>${analysis.TAKE_PROFIT_2}</div>
                    </div>
                    <div class="level-item level-sell">
                        <div>Stop Loss</div>
                        <div>${analysis.STOP_LOSS}</div>
                    </div>
                    <div class="level-item level-neutral">
                        <div>Current Price</div>
                        <div>${typeof currentPrice === 'number' ? currentPrice.toFixed(4) : currentPrice}</div>
                    </div>
                </div>
            `;
            
            const chartContainer = document.querySelector('.chart-container');
            if (chartContainer) {
                const existingLevels = chartContainer.querySelector('.trading-levels');
                if (existingLevels) {
                    existingLevels.remove();
                }
                chartContainer.insertAdjacentHTML('beforeend', levelsHtml);
            }
        }

        function displayHistoricalStats(data) {
            if (!data || !data.data_points) return '';
            
            let statsHtml = '';
            
            if (data.historical_stats) {
                statsHtml = `
                    <div class="historical-stats">
                        <h4>üìà Historical Performance</h4>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div>1 Period</div>
                                <div class="percentage-change">${data.historical_stats['1_period_change']?.toFixed(2) || '0.00'}%</div>
                            </div>
                            <div class="stat-item">
                                <div>5 Periods</div>
                                <div class="percentage-change">${data.historical_stats['5_period_change']?.toFixed(2) || '0.00'}%</div>
                            </div>
                            <div class="stat-item">
                                <div>10 Periods</div>
                                <div class="percentage-change">${data.historical_stats['10_period_change']?.toFixed(2) || '0.00'}%</div>
                            </div>
                            <div class="stat-item">
                                <div>20 Periods</div>
                                <div class="percentage-change">${data.historical_stats['20_period_change']?.toFixed(2) || '0.00'}%</div>
                            </div>
                            <div class="stat-item">
                                <div>10P High</div>
                                <div>${data.historical_stats['high_10_period']?.toFixed(4) || '0.0000'}</div>
                            </div>
                            <div class="stat-item">
                                <div>10P Low</div>
                                <div>${data.historical_stats['low_10_period']?.toFixed(4) || '0.0000'}</div>
                            </div>
                            <div class="stat-item">
                                <div>Volatility</div>
                                <div>${data.historical_stats['volatility']?.toFixed(2) || '0.00'}%</div>
                            </div>
                            <div class="stat-item">
                                <div>Data Points</div>
                                <div>${data.historical_stats['total_periods'] || '0'}</div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            statsHtml += `
                <div class="data-info">
                    <strong>Data Information:</strong> ${data.data_points} data points | ${data.data_period || 'N/A'}
                </div>
            `;
            
            return statsHtml;
        }

        function colorCodePercentageChanges() {
            const changes = document.querySelectorAll('.percentage-change');
            changes.forEach(element => {
                const value = parseFloat(element.textContent);
                if (value > 0) {
                    element.style.color = '#27ae60';
                    element.innerHTML = '+' + element.innerHTML;
                } else if (value < 0) {
                    element.style.color = '#e74c3c';
                } else {
                    element.style.color = '#7f8c8d';
                }
            });
        }

        function displayAnalysis(data) {
            console.log('Displaying analysis:', data);
            
            const analysis = data.ai_analysis;
            const signalClass = `signal-${analysis.SIGNAL.toLowerCase().split(' ')[0]}`;
            const signalDisplayClass = `signal-${analysis.SIGNAL.toLowerCase().split(' ')[0]}-display`;
            const priceChangeClass = data.price_change >= 0 ? 'positive' : 'negative';
            const priceChangeSymbol = data.price_change >= 0 ? '‚Üó' : '‚Üò';
            
            const html = `
                <div class="analysis-grid">
                    <div class="card ${signalClass}">
                        <h2>${data.pair} Analysis - ${data.timeframe}</h2>
                        <div class="price-display">${data.current_price}</div>
                        <div class="price-change ${priceChangeClass}">
                            ${priceChangeSymbol} ${data.price_change}%
                        </div>
                        
                        <div class="confidence-bar">
                            <div class="confidence-fill" style="width: ${analysis.CONFIDENCE_LEVEL}%"></div>
                        </div>
                        <div style="text-align: center; margin: 10px 0;">
                            <strong>AI Confidence: ${analysis.CONFIDENCE_LEVEL}%</strong>
                        </div>
                        
                        <div class="signal-display ${signalDisplayClass}">
                            üö® TRADING SIGNAL: ${analysis.SIGNAL} üö®
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 12px; border-radius: 6px; margin: 12px 0;">
                            <h4>üìà Trading Levels</h4>
                            <p><strong>Entry Price:</strong> ${analysis.ENTRY_PRICE}</p>
                            <p><strong>Take Profit 1:</strong> ${analysis.TAKE_PROFIT_1}</p>
                            <p><strong>Take Profit 2:</strong> ${analysis.TAKE_PROFIT_2}</p>
                            <p><strong>Stop Loss:</strong> ${analysis.STOP_LOSS}</p>
                            <p><strong>Risk/Reward:</strong> ${analysis.RISK_REWARD_RATIO}</p>
                            <p><strong>Time Horizon:</strong> ${analysis.TIME_HORIZON}</p>
                        </div>
                    </div>

                    <div class="card">
                        <h3>üìä Technical Indicators</h3>
                        <div class="technical-grid">
                            <div class="tech-item"><strong>RSI:</strong> ${data.technical_indicators.RSI}</div>
                            <div class="tech-item"><strong>MACD:</strong> ${data.technical_indicators.MACD}</div>
                            <div class="tech-item"><strong>SMA 20:</strong> ${data.technical_indicators.SMA_20}</div>
                            <div class="tech-item"><strong>SMA 50:</strong> ${data.technical_indicators.SMA_50}</div>
                            <div class="tech-item"><strong>EMA 200:</strong> ${data.technical_indicators.EMA_200}</div>
                            <div class="tech-item"><strong>ATR:</strong> ${data.technical_indicators.ATR}</div>
                            <div class="tech-item"><strong>Support:</strong> ${data.technical_indicators.Support}</div>
                            <div class="tech-item"><strong>Resistance:</strong> ${data.technical_indicators.Resistance}</div>
                            <div class="tech-item"><strong>BB Upper:</strong> ${data.technical_indicators.BB_Upper}</div>
                            <div class="tech-item"><strong>BB Lower:</strong> ${data.technical_indicators.BB_Lower}</div>
                        </div>
                        ${displayHistoricalStats(data)}
                    </div>

                    <div class="card">
                        <h3>üì∞ Market News</h3>
                        ${(data.fundamental_news || []).map(news => `
                            <div class="news-item">
                                <strong>üìª ${news.source}</strong> 
                                <span style="float: right; color: #7f8c8d;">${news.timestamp}</span><br>
                                ${news.headline}
                            </div>
                        `).join('')}
                    </div>

                    <div class="card">
                        <h3>ü§ñ AI Analysis Summary</h3>
                        <p style="line-height: 1.6; background: #f8f9fa; padding: 12px; border-radius: 6px;">
                            ${analysis.ANALYSIS_SUMMARY}
                        </p>
                        <div style="margin-top: 12px; text-align: center; color: #7f8c8d;">
                            <small>Last updated: ${data.timestamp}</small>
                        </div>
                    </div>

                    <div class="card" style="grid-column: 1 / -1;">
                        <h3>üìà Real-time Price Chart</h3>
                        <div class="chart-controls">
                            <button class="chart-btn ${currentChartType === 'line' ? 'active' : ''}" 
                                    onclick="switchChartType('line')">Line Chart</button>
                        </div>
                        <div class="chart-container">
                            <canvas id="priceChart"></canvas>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('results').innerHTML = html;
            
            // Color code percentage changes
            setTimeout(colorCodePercentageChanges, 100);
            
            // Create chart after DOM is updated
            setTimeout(() => {
                if (data.chart_data && data.chart_data.dates && data.chart_data.dates.length > 0) {
                    console.log('Creating chart with data length:', data.chart_data.dates.length);
                    createChart(data.chart_data, data.ai_analysis);
                } else {
                    console.warn('No chart data available');
                    showError('No chart data available for display');
                }
            }, 100);
        }

        function displayAllAnalysis(data) {
            let html = '<div class="analysis-grid">';
            
            for (const [pair, analysis] of Object.entries(data)) {
                if (analysis.error) {
                    html += `
                        <div class="card">
                            <h3>${pair}</h3>
                            <div style="color: #e74c3c;">Error: ${analysis.error}</div>
                        </div>
                    `;
                    continue;
                }
                
                const ai = analysis.ai_analysis;
                const signalClass = `signal-${ai.SIGNAL.toLowerCase().split(' ')[0]}`;
                
                html += `
                    <div class="card ${signalClass}">
                        <h3>${pair} - ${analysis.timeframe}</h3>
                        <div class="price-display">${analysis.current_price}</div>
                        
                        <div class="signal-display signal-${ai.SIGNAL.toLowerCase().split(' ')[0]}-display">
                            ${ai.SIGNAL} (${ai.CONFIDENCE_LEVEL}%)
                        </div>
                        
                        <div style="margin: 8px 0;">
                            <strong>Entry:</strong> ${ai.ENTRY_PRICE}<br>
                            <strong>TP1:</strong> ${ai.TAKE_PROFIT_1}<br>
                            <strong>TP2:</strong> ${ai.TAKE_PROFIT_2}<br>
                            <strong>SL:</strong> ${ai.STOP_LOSS}<br>
                            <strong>R/R:</strong> ${ai.RISK_REWARD_RATIO}
                        </div>
                        
                        <div style="font-size: 0.8em; color: #7f8c8d;">
                            Updated: ${analysis.timestamp}
                        </div>
                    </div>
                `;
            }
            
            html += '</div>';
            document.getElementById('results').innerHTML = html;
        }

        function showLoading() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').innerHTML = '';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.innerText = message;
            errorDiv.style.display = 'block';
            console.error('Error:', message);
        }

        function hideError() {
            document.getElementById('error').style.display = 'none';
        }

        // Initial load when page is ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded, starting analysis...');
            loadAnalysis();
            
            // Check system status on load
            setTimeout(checkSystemStatus, 2000);
        });
    </script>
</body>
</html>
