<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ðŸ“Š AI Forex Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #f3f6fa; color: #333; }
    header { background: #2c3e50; color: white; padding: 12px; font-size: 20px; text-align: center; }
    .container { display: flex; flex-wrap: wrap; padding: 15px; gap: 15px; }
    .card { background: white; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); padding: 15px; flex: 1; }
    .half { flex: 0 0 48%; }
    h3 { margin-top: 0; color: #2c3e50; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    td, th { border: 1px solid #ddd; padding: 6px; font-size: 13px; }
    th { background: #f0f0f0; text-align: left; }
    .btn { padding: 6px 12px; margin-top: 5px; border: none; background: #3498db; color: white; border-radius: 5px; cursor: pointer; }
    .btn:hover { background: #2980b9; }
    .settings label { display: block; margin-top: 5px; }
    .highlight { font-weight: bold; color: #e67e22; }
  </style>
</head>
<body>
  <header>ðŸ“Š AI Forex Dashboard</header>

  <div class="container">
    <!-- Settings -->
    <div class="card half settings">
      <h3>Settings</h3>
      <label>
        Pair:
        <select id="pair">
          <option value="USDJPY">USDJPY</option>
          <option value="GBPJPY">GBPJPY</option>
          <option value="EURJPY">EURJPY</option>
          <option value="CHFJPY">CHFJPY</option>
        </select>
      </label>
      <label>
        Timeframe:
        <select id="timeframe">
          <option value="1H">1H</option>
          <option value="4H">4H</option>
          <option value="1D">1D</option>
        </select>
      </label>
      <label>
        <input type="checkbox" id="useHistory"> Use Historical Data
      </label>
      <button class="btn" onclick="analyze()">Analyze</button>
    </div>

    <!-- AI Analysis -->
    <div class="card half">
      <h3>AI Analysis (DeepSeek)</h3>
      <table>
        <tr><th>Signal</th><td id="ai_signal"></td></tr>
        <tr><th>Entry</th><td id="ai_entry"></td></tr>
        <tr><th>Stop Loss</th><td id="ai_sl"></td></tr>
        <tr><th>Take Profit 1</th><td id="ai_tp1"></td></tr>
        <tr><th>Take Profit 2</th><td id="ai_tp2"></td></tr>
        <tr><th>Confidence</th><td id="ai_conf"></td></tr>
      </table>
      <p id="ai_advice" style="font-size: 13px; margin-top: 8px; color: #555;"></p>
    </div>

    <!-- Chart -->
    <div class="card half">
      <h3>Price Chart</h3>
      <canvas id="priceChart"></canvas>
    </div>

    <!-- Technical Indicators -->
    <div class="card half">
      <h3>Technical Indicators</h3>
      <table>
        <tr><th>RSI</th><td id="ind_rsi"></td></tr>
        <tr><th>MACD</th><td id="ind_macd"></td></tr>
        <tr><th>SMA20</th><td id="ind_sma20"></td></tr>
        <tr><th>SMA50</th><td id="ind_sma50"></td></tr>
        <tr><th>EMA200</th><td id="ind_ema200"></td></tr>
        <tr><th>OBV</th><td id="ind_obv"></td></tr>
        <tr><th>Support</th><td id="ind_support"></td></tr>
        <tr><th>Resistance</th><td id="ind_resistance"></td></tr>
      </table>
    </div>

    <!-- Fundamental News -->
    <div class="card half">
      <h3>Fundamental News</h3>
      <p id="fundamental_news">Loading...</p>
    </div>

    <!-- Quick Overview -->
    <div class="card half">
      <h3>Quick Overview</h3>
      <div id="quick_overview"></div>
    </div>
  </div>

  <script>
    let chart;

    async function analyze() {
      const pair = document.getElementById("pair").value;
      const tf = document.getElementById("timeframe").value;
      const useHist = document.getElementById("useHistory").checked ? "1" : "0";

      const res = await fetch(`/get_analysis?pair=${pair}&timeframe=${tf}&use_history=${useHist}`);
      const data = await res.json();
      console.log("Analysis data:", data);

      if (data.error) { alert(data.error); return; }

      // AI Analysis
      document.getElementById("ai_signal").innerText = data.ai_analysis.SIGNAL;
      document.getElementById("ai_entry").innerText = data.ai_analysis.ENTRY_PRICE;
      document.getElementById("ai_sl").innerText = data.ai_analysis.STOP_LOSS;
      document.getElementById("ai_tp1").innerText = data.ai_analysis.TAKE_PROFIT_1;
      document.getElementById("ai_tp2").innerText = data.ai_analysis.TAKE_PROFIT_2;
      document.getElementById("ai_conf").innerText = data.ai_analysis.CONFIDENCE_LEVEL + "%";
      document.getElementById("ai_advice").innerText = data.ai_analysis.TRADING_ADVICE;

      // Technical Indicators
      const ind = data.technical_indicators;
      document.getElementById("ind_rsi").innerText = ind.RSI;
      document.getElementById("ind_macd").innerText = ind.MACD;
      document.getElementById("ind_sma20").innerText = ind.SMA20;
      document.getElementById("ind_sma50").innerText = ind.SMA50;
      document.getElementById("ind_ema200").innerText = ind.EMA200;
      document.getElementById("ind_obv").innerText = ind.OBV;
      document.getElementById("ind_support").innerText = ind.Support;
      document.getElementById("ind_resistance").innerText = ind.Resistance;

      // Fundamental News
      document.getElementById("fundamental_news").innerText = data.fundamental_news;

      // Chart
      const ctx = document.getElementById("priceChart").getContext("2d");
      if (chart) chart.destroy();
      chart = new Chart(ctx, {
        type: "line",
        data: {
          labels: data.chart_data.dates,
          datasets: [{
            label: pair + " Close",
            data: data.chart_data.close,
            borderColor: "#2980b9",
            fill: false,
            tension: 0.2
          }]
        },
        options: {
          responsive: true,
          scales: { x: { display: true }, y: { display: true } }
        }
      });
    }

    async function quickOverview() {
      const res = await fetch("/quick_overview");
      const data = await res.json();
      let html = "<table>";
      for (const [pair, val] of Object.entries(data)) {
        html += `<tr><td><b>${pair}</b></td><td>${val.price}</td></tr>`;
      }
      html += "</table>";
      document.getElementById("quick_overview").innerHTML = html;
    }

    quickOverview();
    analyze();
  </script>
</body>
</html>
