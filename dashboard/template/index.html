<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ANDRO-FX Precision Forex Trading</title>

  <!-- Pastikan CSS dan JS libraries di-load dengan benar -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    :root {
      --deepseek-primary: #0066cc;
      --deepseek-secondary: #00aaff;
      --deepseek-accent: #004499;
      --signal-buy: #10b981;
      --signal-sell: #ef4444;
      --signal-hold: #f59e0b;
      --text-primary: #1f2937;
      --text-secondary: #6b7280;
      --bg-primary: #f8fafc;
      --bg-card: #ffffff;
      --border-radius: 12px;
    }

    body {
      background: var(--bg-primary);
      color: var(--text-primary);
      font-family: "Inter", "Segoe UI", sans-serif;
      padding: 18px;
      margin: 0;
    }

    .topbar {
      display: flex;
      gap: 15px;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      padding: 15px 20px;
      background: var(--bg-card);
      border-radius: var(--border-radius);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    .brand-logo {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 700;
      font-size: 1.5rem;
      color: var(--deepseek-primary);
    }

    .brand-logo i {
      color: var(--deepseek-secondary);
    }

    .card-soft {
      background: var(--bg-card);
      border-radius: var(--border-radius);
      padding: 20px;
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.05);
      margin-bottom: 20px;
      border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .section-title {
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--deepseek-primary);
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .section-title i {
      color: var(--deepseek-secondary);
    }

    #chartRoot { 
      height: 520px; 
      border-radius: var(--border-radius); 
      background: var(--bg-card);
      width: 100%;
    }
    
    #macdRoot { 
      height: 160px; 
      margin-top: 15px; 
      border-radius: var(--border-radius); 
      background: var(--bg-card);
      width: 100%;
    }

    .muted { 
      color: var(--text-secondary); 
      font-size: 0.95rem; 
    }

    .ai-signal-buy { 
      color: white; 
      background: var(--signal-buy); 
      padding: 8px 16px; 
      border-radius: 8px; 
      font-weight: 700;
      font-size: 1.2rem;
      text-align: center;
      box-shadow: 0 4px 6px rgba(16, 185, 129, 0.3);
    }

    .ai-signal-sell { 
      color: white; 
      background: var(--signal-sell); 
      padding: 8px 16px; 
      border-radius: 8px; 
      font-weight: 700;
      font-size: 1.2rem;
      text-align: center;
      box-shadow: 0 4px 6px rgba(239, 68, 68, 0.3);
    }

    .ai-signal-hold { 
      color: white; 
      background: var(--signal-hold); 
      padding: 8px 16px; 
      border-radius: 8px; 
      font-weight: 700;
      font-size: 1.2rem;
      text-align: center;
      box-shadow: 0 4px 6px rgba(245, 158, 11, 0.3);
    }

    .small-muted { 
      color: var(--text-secondary); 
      font-size: 0.9rem; 
    }

    .status-indicator {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 8px;
    }

    .status-live { background-color: var(--signal-buy); }
    .status-offline { background-color: var(--signal-sell); }

    .metric-card {
      background: var(--bg-primary);
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 12px;
      border-left: 4px solid var(--deepseek-secondary);
    }

    .metric-value {
      font-size: 1.4rem;
      font-weight: 700;
    }

    .backtest-panel {
      max-height: 400px;
      overflow-y: auto;
    }

    .performance-grade {
      font-size: 1.6rem;
      font-weight: bold;
      text-align: center;
      padding: 12px;
      border-radius: 10px;
      margin: 12px 0;
    }

    .grade-a { background: #d1fae5; color: #065f46; }
    .grade-b { background: #fef3c7; color: #92400e; }
    .grade-c { background: #fde68a; color: #78350f; }
    .grade-d { background: #fecaca; color: #991b1b; }

    .trading-level {
      font-size: 1.1rem;
      font-weight: 600;
      padding: 8px 12px;
      border-radius: 8px;
      margin: 5px 0;
    }

    .level-entry { 
      background: rgba(16, 185, 129, 0.1); 
      color: var(--signal-buy);
      border-left: 4px solid var(--signal-buy);
    }

    .level-sl { 
      background: rgba(239, 68, 68, 0.1); 
      color: var(--signal-sell);
      border-left: 4px solid var(--signal-sell);
    }

    .level-tp { 
      background: rgba(34, 197, 94, 0.1); 
      color: #16a34a;
      border-left: 4px solid #16a34a;
    }

    .btn-deepseek {
      background: var(--deepseek-primary);
      color: white;
      font-weight: 600;
      border: none;
      border-radius: 8px;
      padding: 8px 16px;
    }

    .btn-deepseek:hover {
      background: var(--deepseek-accent);
      color: white;
    }

    .btn-action {
      background: var(--deepseek-secondary);
      color: white;
      font-weight: 600;
      border: none;
      border-radius: 8px;
      padding: 8px 16px;
    }

    .btn-action:hover {
      background: var(--deepseek-primary);
      color: white;
    }

    .price-ticker {
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--deepseek-primary);
    }

    .price-change {
      font-size: 1.1rem;
      font-weight: 600;
    }

    .change-positive { color: var(--signal-buy); }
    .change-negative { color: var(--signal-sell); }

    .risk-approved { 
      color: var(--signal-buy); 
      font-weight: 700;
      font-size: 1.1rem;
    }

    .risk-rejected { 
      color: var(--signal-sell); 
      font-weight: 700;
      font-size: 1.1rem;
    }

    .tech-indicator {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }

    .indicator-value {
      font-weight: 700;
      font-size: 1.1rem;
    }

    .news-container {
      max-height: 120px;
      overflow-y: auto;
      padding: 10px;
      background: var(--bg-primary);
      border-radius: 8px;
      border-left: 4px solid var(--deepseek-secondary);
    }

    /* Loading Spinner */
    .spinner-container {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .chart-loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 10;
      background: rgba(255, 255, 255, 0.8);
      padding: 10px 20px;
      border-radius: 8px;
      display: none;
    }

    .realtime-indicator {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(16, 185, 129, 0.1);
      color: #10b981;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.7rem;
      font-weight: 600;
      z-index: 5;
    }
  </style>
</head>
<body>

<div class="topbar">
  <div class="brand-logo">
    <i class="fas fa-brain"></i>
    <span>ANDRO-FX Precision Forex Trading</span>
  </div>
  
  <div class="d-flex flex-wrap gap-3 align-items-center ms-auto">
    <div class="d-flex align-items-center">
      <label class="small-muted mb-0 me-2">Pair</label>
      <select id="pairSelect" class="form-select form-select-sm" style="width:130px;">
        <option>USDJPY</option>
        <option>EURJPY</option>
        <option>GBPJPY</option>
        <option>CHFJPY</option>
        <option>GBPUSD</option>
        <option>USDCHF</option>
        <option>AUDUSD</option>
        <option>USDCAD</option>
        <option>NZDUSD</option>
      </select>
    </div>
    
    <div class="d-flex align-items-center">
      <label class="small-muted mb-0 me-2">Timeframe</label>
      <select id="timeframeSelect" class="form-select form-select-sm" style="width:100px;">
        <option>1D</option>
        <option>4H</option>
        <option>1H</option>
        <option>M30</option>
      </select>
    </div>
    
    <button id="analyzeBtn" class="btn btn-deepseek">
      <i class="fas fa-chart-line me-2"></i>Analyze
    </button>
    
    <button id="runBacktestBtn" class="btn btn-action">
      <i class="fas fa-play-circle me-2"></i>Backtest
    </button>
    
    <div id="pairTicker" class="d-flex align-items-center ms-3">
      <span id="selectedPair" class="price-ticker me-2">USDJPY –</span>
      <span id="livePrice" class="price-ticker">0.0000</span>
      <span id="pairChange" class="price-change ms-2">(0.00%)</span>
      <span id="statusIndicator" class="status-indicator status-offline ms-2"></span>
    </div>
  </div>
</div>

<div class="row g-4">
  <div class="col-lg-8">
    <div class="card-soft position-relative">
      <div class="chart-loading" id="chartLoading">
        <div class="spinner-border text-primary" role="status"></div>
        <span class="ms-2">Loading chart data...</span>
      </div>
      <div class="realtime-indicator" id="realtimeIndicator" style="display: none;">
        <i class="fas fa-circle me-1"></i> LIVE
      </div>
      <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
          <div class="section-title">
            <i class="fas fa-chart-candlestick"></i>
            <span>Live Price Chart</span>
          </div>
          <div class="muted" id="chartSubtitle">Real-time Candlestick · EMA26 · MACD</div>
        </div>
        <div class="text-end">
          <div class="small-muted">Current Price</div>
          <div class="price-ticker" id="currentPrice">-</div>
        </div>
      </div>
      <div id="chartRoot"></div>
      <div id="macdRoot"></div>
    </div>
  </div>

  <div class="col-lg-4">
    <!-- AI Trading Signal Card -->
    <div class="card-soft">
      <div class="section-title">
        <i class="fas fa-robot"></i>
        <span>AI Trading Signal</span>
      </div>
      
      <div id="aiSummary" class="muted mb-3">No analysis yet. Click Analyze to start.</div>
      
      <div class="mb-3">
        <div class="small-muted mb-2">TRADING SIGNAL</div>
        <div id="aiSignalBadge" class="ai-signal-hold">HOLD</div>
      </div>
      
      <div class="row mb-3">
        <div class="col-6">
          <div class="metric-card">
            <div class="small-muted">Confidence</div>
            <div class="metric-value" id="aiConfidence">-</div>
          </div>
        </div>
        <div class="col-6">
          <div class="metric-card">
            <div class="small-muted">Risk Level</div>
            <div class="metric-value" id="aiRisk">-</div>
          </div>
        </div>
      </div>
      
      <div class="mb-3">
        <div class="small-muted mb-2">TRADING LEVELS</div>
        <div class="trading-level level-entry">
          <i class="fas fa-sign-in-alt me-2"></i>Entry: <span id="aiEntry">-</span>
        </div>
        <div class="trading-level level-sl">
          <i class="fas fa-stop-circle me-2"></i>Stop Loss: <span id="aiSL">-</span>
        </div>
        <div class="trading-level level-tp">
          <i class="fas fa-target me-2"></i>Take Profit 1: <span id="aiTP1">-</span>
        </div>
        <div class="trading-level level-tp">
          <i class="fas fa-bullseye me-2"></i>Take Profit 2: <span id="aiTP2">-</span>
        </div>
      </div>
    </div>

    <!-- Technical Analysis Card -->
    <div class="card-soft">
      <div class="section-title">
        <i class="fas fa-chart-bar"></i>
        <span>Technical Analysis</span>
      </div>
      
      <div class="tech-indicator">
        <span class="small-muted">RSI</span>
        <span class="indicator-value" id="rsiVal">-</span>
      </div>
      <div class="tech-indicator">
        <span class="small-muted">MACD</span>
        <span class="indicator-value" id="macdVal">-</span>
      </div>
      <div class="tech-indicator">
        <span class="small-muted">MACD Histogram</span>
        <span class="indicator-value" id="macdHistVal">-</span>
      </div>
      <div class="tech-indicator">
        <span class="small-muted">ADX</span>
        <span class="indicator-value" id="adxVal">-</span>
      </div>
      <div class="tech-indicator">
        <span class="small-muted">ATR</span>
        <span class="indicator-value" id="atrVal">-</span>
      </div>
      <div class="tech-indicator">
        <span class="small-muted">Volatility</span>
        <span class="indicator-value" id="volVal">-</span>
      </div>
      <div class="tech-indicator">
        <span class="small-muted">Trend</span>
        <span class="indicator-value" id="trendVal">-</span>
      </div>
    </div>
    
    <div class="card-soft">
      <div class="section-title">
        <i class="fas fa-chart-line"></i>
        <span>Backtest Results</span>
        <span id="backtestStatus" class="badge bg-secondary ms-2">Not Run</span>
      </div>
      <div id="backtestResults" class="backtest-panel">
        <div class="text-center muted">Run backtest to see performance results</div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- Load Lightweight Charts dengan approach yang lebih aman -->
<script>
  // Tunggu sampai DOM siap
  document.addEventListener('DOMContentLoaded', function() {
    // Load Lightweight Charts secara dinamis
    const script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/npm/lightweight-charts@4.0.0/dist/lightweight-charts.standalone.production.js';
    script.onload = initializeApp;
    script.onerror = function() {
      console.error('Failed to load Lightweight Charts');
      // Fallback: Tampilkan pesan error
      document.getElementById('chartRoot').innerHTML = '<div class="alert alert-danger">Failed to load chart library. Please check your internet connection.</div>';
      initializeApp(); // Tetap initialize app tanpa charts
    };
    document.head.appendChild(script);
  });

  function initializeApp() {
    console.log('Initializing ANDRO-FX Trading Dashboard...');
    
    // Cek jika Lightweight Charts tersedia
    if (typeof LightweightCharts === 'undefined') {
      console.warn('Lightweight Charts not available, running in limited mode');
      document.getElementById('chartRoot').innerHTML = '<div class="alert alert-warning">Charts unavailable. Running in limited mode.</div>';
      document.getElementById('macdRoot').innerHTML = '<div class="alert alert-warning">MACD Chart unavailable.</div>';
    } else {
      initializeCharts();
    }
    
    // Initialize komponen lainnya
    initializeComponents();
  }

  function initializeCharts() {
    try {
      console.log('Initializing charts...');
      
      // Chart utama
      const chartOptions = {
        layout: { 
          backgroundColor: '#fff', 
          textColor: '#111' 
        },
        grid: {
          vertLines: { color: '#f3f4f6' },
          horzLines: { color: '#f3f4f6' }
        },
        width: document.getElementById('chartRoot').clientWidth,
        height: 520
      };

      const chart = LightweightCharts.createChart(document.getElementById('chartRoot'), chartOptions);
      const candleSeries = chart.addCandlestickSeries();
      
      // Data sample untuk demo
      const sampleData = [
        { time: '2023-01-01', open: 145.0, high: 146.5, low: 144.5, close: 146.0 },
        { time: '2023-01-02', open: 146.0, high: 147.2, low: 145.8, close: 146.5 },
        { time: '2023-01-03', open: 146.5, high: 147.8, low: 146.2, close: 147.5 },
        { time: '2023-01-04', open: 147.5, high: 148.0, low: 146.8, close: 147.2 },
        { time: '2023-01-05', open: 147.2, high: 148.5, low: 147.0, close: 148.2 }
      ];
      
      candleSeries.setData(sampleData);
      
      // MACD Chart
      const macdChart = LightweightCharts.createChart(document.getElementById('macdRoot'), {
        width: document.getElementById('macdRoot').clientWidth,
        height: 160
      });
      
      const macdLine = macdChart.addLineSeries({ color: '#0ea5e9' });
      macdLine.setData([
        { time: '2023-01-01', value: 0.1 },
        { time: '2023-01-02', value: 0.2 },
        { time: '2023-01-03', value: 0.15 },
        { time: '2023-01-04', value: 0.05 },
        { time: '2023-01-05', value: 0.1 }
      ]);
      
      console.log('Charts initialized successfully');
      
    } catch (error) {
      console.error('Error initializing charts:', error);
      document.getElementById('chartRoot').innerHTML = '<div class="alert alert-danger">Error initializing charts: ' + error.message + '</div>';
    }
  }

  function initializeComponents() {
    console.log('Initializing components...');
    
    // Initialize nilai default
    document.getElementById('livePrice').textContent = '148.25';
    document.getElementById('currentPrice').textContent = '148.25';
    document.getElementById('pairChange').textContent = '(+0.15%)';
    document.getElementById('pairChange').className = 'price-change change-positive';
    
    // Setup event listeners
    document.getElementById('analyzeBtn').addEventListener('click', function() {
      simulateAnalysis();
    });
    
    document.getElementById('runBacktestBtn').addEventListener('click', function() {
      simulateBacktest();
    });
    
    // Setup dropdown changes
    document.getElementById('pairSelect').addEventListener('change', function() {
      document.getElementById('selectedPair').textContent = this.value + ' –';
    });
    
    console.log('Components initialized successfully');
  }

  function simulateAnalysis() {
    console.log('Simulating analysis...');
    
    // Show loading
    document.getElementById('chartLoading').style.display = 'flex';
    
    // Simulate API call delay
    setTimeout(function() {
      // Update AI Signal
      const signals = ['BUY', 'SELL', 'HOLD'];
      const randomSignal = signals[Math.floor(Math.random() * signals.length)];
      
      document.getElementById('aiSignalBadge').textContent = randomSignal;
      document.getElementById('aiSignalBadge').className = 
        randomSignal === 'BUY' ? 'ai-signal-buy' : 
        randomSignal === 'SELL' ? 'ai-signal-sell' : 'ai-signal-hold';
      
      // Update other values
      document.getElementById('aiConfidence').textContent = Math.floor(Math.random() * 30 + 70) + '%';
      document.getElementById('aiRisk').textContent = ['Low', 'Medium', 'High'][Math.floor(Math.random() * 3)];
      document.getElementById('aiEntry').textContent = (148 + Math.random() * 0.5).toFixed(3);
      document.getElementById('aiSL').textContent = (147.5 + Math.random() * 0.5).toFixed(3);
      document.getElementById('aiTP1').textContent = (148.5 + Math.random() * 0.5).toFixed(3);
      document.getElementById('aiTP2').textContent = (149 + Math.random() * 0.5).toFixed(3);
      document.getElementById('aiSummary').textContent = 'AI analysis completed. Market shows ' + 
        (randomSignal === 'BUY' ? 'bullish' : randomSignal === 'SELL' ? 'bearish' : 'neutral') + ' signals.';
      
      // Update technical indicators
      document.getElementById('rsiVal').textContent = (Math.random() * 30 + 40).toFixed(2);
      document.getElementById('macdVal').textContent = (Math.random() * 0.1 - 0.05).toFixed(4);
      document.getElementById('macdHistVal').textContent = (Math.random() * 0.05 - 0.025).toFixed(4);
      document.getElementById('adxVal').textContent = (Math.random() * 20 + 20).toFixed(2);
      document.getElementById('atrVal').textContent = (Math.random() * 0.2 + 0.1).toFixed(4);
      document.getElementById('volVal').textContent = (Math.random() * 5 + 5).toFixed(2) + '%';
      document.getElementById('trendVal').textContent = ['Up', 'Down', 'Sideways'][Math.floor(Math.random() * 3)];
      
      // Update status
      document.getElementById('statusIndicator').className = 'status-indicator status-live';
      document.getElementById('realtimeIndicator').style.display = 'block';
      
      // Hide loading
      document.getElementById('chartLoading').style.display = 'none';
      
      console.log('Analysis simulation completed');
    }, 1500);
  }

  function simulateBacktest() {
    console.log('Simulating backtest...');
    
    document.getElementById('backtestStatus').textContent = 'Running...';
    document.getElementById('backtestStatus').className = 'badge bg-warning';
    
    // Simulate backtest delay
    setTimeout(function() {
      const resultsHTML = `
        <div class="performance-grade grade-a">Performance: A</div>
        <div class="row">
          <div class="col-6">
            <div class="metric-card">
              <div class="small-muted">Total Trades</div>
              <div class="metric-value">42</div>
            </div>
          </div>
          <div class="col-6">
            <div class="metric-card">
              <div class="small-muted">Win Rate</div>
              <div class="metric-value change-positive">67.5%</div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-6">
            <div class="metric-card">
              <div class="small-muted">Total Profit</div>
              <div class="metric-value change-positive">$1,250.75</div>
            </div>
          </div>
          <div class="col-6">
            <div class="metric-card">
              <div class="small-muted">Final Balance</div>
              <div class="metric-value">$11,250.75</div>
            </div>
          </div>
        </div>
      `;
      
      document.getElementById('backtestResults').innerHTML = resultsHTML;
      document.getElementById('backtestStatus').textContent = 'Completed';
      document.getElementById('backtestStatus').className = 'badge bg-success';
      
      console.log('Backtest simulation completed');
    }, 2000);
  }
</script>
</body>
</html>
