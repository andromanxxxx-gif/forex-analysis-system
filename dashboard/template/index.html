  <script>
    let priceChart;

    async function getQuickOverview(){
      const res=await fetch("/quick_overview"); 
      const data=await res.json();
      const container=document.getElementById("quickOverview");
      container.innerHTML="";
      for(const [pair,info] of Object.entries(data)){
        const div=document.createElement("div");
        div.className="quick-card";
        div.innerHTML=`<div style="font-weight:bold">${pair}</div><div>${info.price.toFixed(3)}</div>`;
        container.appendChild(div);
      }
    }

    async function getAnalysis(){
      const pair=document.getElementById("pairSelect").value;
      const tf=document.getElementById("timeframeSelect").value;
      const useHist=document.getElementById("useHistory").checked;
      let url=`/get_analysis?pair=${pair}&timeframe=${tf}`;
      if(useHist) url+="&use_history=1";
      try{
        const res=await fetch(url); 
        const data=await res.json();
        if(data.error){alert(data.error);return;}
        updateUI(data);
      }catch(e){alert("Error: "+e.message);}
    }

    function updateUI(data){
      document.getElementById("pairTitle").textContent=`${data.pair} â€” ${data.timeframe}`;
      document.getElementById("dataSource").textContent="Data source: "+data.data_source;
      document.getElementById("currentPrice").textContent=data.current_price;

      const ai=data.ai_analysis;
      const sig=ai.SIGNAL;
      const badge=document.getElementById("signalBadge");
      badge.textContent=sig;
      badge.className="badge "+(sig==="BUY"?"buy":sig==="SELL"?"sell":"hold");

      document.getElementById("signalType").textContent=sig;
      document.getElementById("entryPrice").textContent=ai.ENTRY_PRICE;
      document.getElementById("stopLoss").textContent=ai.STOP_LOSS;
      document.getElementById("takeProfit1").textContent=ai.TAKE_PROFIT_1;
      document.getElementById("takeProfit2").textContent=ai.TAKE_PROFIT_2;
      document.getElementById("confidenceText").textContent=ai.CONFIDENCE_LEVEL+"%";

      const adviceElem=document.getElementById("tradingAdvice");
      if(ai.TRADING_ADVICE && ai.TRADING_ADVICE.toLowerCase().includes("error")){
        adviceElem.className="advice-error";
      } else {
        adviceElem.className="advice-normal";
      }
      adviceElem.textContent=ai.TRADING_ADVICE;

      document.getElementById("fundamentalNews").textContent = "Fundamental: " + data.fundamental_news;

      updateIndicators(data.technical_indicators);
      updateChart(data.chart_data,data.pair);
    }

    function updateIndicators(ind){
      const container=document.getElementById("technicalIndicators");
      container.innerHTML="";
      for(const [k,v] of Object.entries(ind)){
        const div=document.createElement("div");
        div.className="ind-item";
        div.innerHTML=`<div>${k}</div><div><b>${v}</b></div>`;
        container.appendChild(div);
      }
    }

    function updateChart(chartData,pair){
      const ctx=document.getElementById("priceChart").getContext("2d");
      if(priceChart) priceChart.destroy();
      priceChart=new Chart(ctx,{
        type:"line",
        data:{labels:chartData.dates,datasets:[{
          label:pair+" Close",
          data:chartData.close,
          borderColor:"#38bdf8",
          backgroundColor:"rgba(56,189,248,0.1)",
          fill:true,tension:0.2}]},
        options:{responsive:true,maintainAspectRatio:false,
          plugins:{legend:{labels:{color:"#e2e8f0"}}},
          scales:{x:{ticks:{color:"#94a3b8"}},y:{ticks:{color:"#94a3b8"}}}}
      });
    }

    document.addEventListener("DOMContentLoaded",()=>{
      getQuickOverview();
      getAnalysis();
      setInterval(getQuickOverview,60000);
    });
  </script>
</body>
</html>
